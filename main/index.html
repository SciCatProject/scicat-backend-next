<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="about/">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>SciCat Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="css/custom.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#scicat-backend" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="SciCat Documentation" class="md-header__button md-logo" aria-label="SciCat Documentation" data-md-component="logo">
      
  <img src="assets/SciCat-logo-icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SciCat Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SciCat Backend
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="SciCat Documentation" class="md-nav__button md-logo" aria-label="SciCat Documentation" data-md-component="logo">
      
  <img src="assets/SciCat-logo-icon.png" alt="logo">

    </a>
    SciCat Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    SciCat Backend
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    SciCat Backend
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#version-v4x" class="md-nav__link">
    <span class="md-ellipsis">
      
        Version: v4.x
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nestjs-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        NestJS implementation
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="about/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About SciCat
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Developer guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developer guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="developer-guide/release-guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    New Release Version Bump Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="developer-guide/contributing/pr-guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pull Request Guidelines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Frontend config guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Frontend config guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="frontend-config-guide/dynamic-dataset-detail-component/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dynamic Dataset Detail Component - Frontend Configuration Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#version-v4x" class="md-nav__link">
    <span class="md-ellipsis">
      
        Version: v4.x
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nestjs-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        NestJS implementation
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="scicat-backend">SciCat Backend<a class="headerlink" href="#scicat-backend" title="Permanent link">¶</a></h1>
<h2 id="version-v4x">Version: v4.x<a class="headerlink" href="#version-v4x" title="Permanent link">¶</a></h2>
<h2 id="nestjs-implementation">NestJS implementation<a class="headerlink" href="#nestjs-implementation" title="Permanent link">¶</a></h2>
<p><a href="https://github.com/SciCatProject/scicat-backend-next/actions/workflows/test.yml"><img alt="Test" src="https://github.com/SciCatProject/scicat-backend-next/actions/workflows/test.yml/badge.svg"></a>
<a href="https://github.com/SciCatProject/scicat-backend-next/actions/workflows/deploy.yml"><img alt="Deploy" src="https://github.com/SciCatProject/scicat-backend-next/actions/workflows/deploy.yml/badge.svg"></a>
<a href="https://github.com/SciCatProject/scicat-backend-next/actions/workflows/upload-sdk-artifact.yml"><img alt="Generate and upload latest SDK artifacts" src="https://github.com/SciCatProject/scicat-backend-next/actions/workflows/upload-sdk-artifact.yml/badge.svg?branch=master"></a>
<a href="https://deepscan.io/dashboard#view=project&amp;tid=8394&amp;pid=19251&amp;bid=494247"><img alt="DeepScan grade" src="https://deepscan.io/api/teams/8394/projects/19251/branches/494247/badge/grade.svg"></a>
<a href="https://snyk.io/test/github/SciCatProject/scicat-backend-next/master?targetFile=package.json"><img alt="Known Vulnerabilities" src="https://snyk.io/test/github/SciCatProject/scicat-backend-next/master/badge.svg?targetFile=package.json"></a></p>
<hr>
<h1 id="important">IMPORTANT!!!!<a class="headerlink" href="#important" title="Permanent link">¶</a></h1>
<p><strong>As of 2023/06/15, this repository holds the official version of SciCat backend</strong>
This is the only version that is officially supported. It is commonly referred to as backend, BE, v4.x or a combination of them.</p>
<p>You can find the old backend (v3.x, loopback implementation) at (https://github.com/SciCatProject/backend).
The repo for backend v3.x is archived and read-only</p>
<p>If you have any questions, please feel free to contact any member of the development team,
or the SciCat team at ESS.</p>
<h2 id="contributing">Contributing<a class="headerlink" href="#contributing" title="Permanent link">¶</a></h2>
<p>If you're planning to contribute to this project by adding new functionality, we encourage you to discuss it first in the Discussions tab. This helps ensure that your proposed changes align with the project's goals and prevents duplicate efforts. Here's how you can initiate a discussion:</p>
<ol>
<li>Go to the <a href="https://github.com/SciCatProject/scicat-backend-next/discussions">Discussions tab</a>.</li>
<li>Start a new discussion thread outlining your proposed changes.</li>
<li>Wait for feedback and consensus before proceeding with creating a pull request.</li>
</ol>
<p>Thank you for your interest in contributing to our project!</p>
<h2 id="get-started">Get started<a class="headerlink" href="#get-started" title="Permanent link">¶</a></h2>
<ol>
<li><code>git clone https://github.com/SciCatProject/scicat-backend-next.git</code></li>
<li><code>npm install</code></li>
<li>Add <em>.env</em> file to project root folder. See <a href="#environment-variables">Environment variables</a>.</li>
<li><em>Optional</em> Add <a href="#local-user-accounts">functionalAccounts.json</a> file to project root folder to create local users.</li>
<li><em>Optional</em> Add <a href="#loggers-configuration">loggers.json</a> file to the root folder and configure multiple loggers.</li>
<li><em>Optional</em> Add <a href="#prpopsal-types-configuration">proposalTypes.json</a> file to the root folder and configure the proposal types.</li>
<li><code>npm run start:dev</code></li>
<li>Go to http://localhost:3000/explorer to get an overview of available endpoints and database schemas.</li>
<li>To be able to run the e2e tests with the same setup as in the Github actions you will need to run <code>npm run  prepare:local</code> and after that run <code>npm run start:dev</code>. This will start all needed containers and copy some configuration to the right place.</li>
</ol>
<h2 id="develop-in-a-container-using-the-docker-composedev-file">Develop in a container using the docker-compose.dev file<a class="headerlink" href="#develop-in-a-container-using-the-docker-composedev-file" title="Permanent link">¶</a></h2>
<ol>
<li><code>git clone https://github.com/SciCatProject/scicat-backend-next.git</code></li>
<li>docker-compose -f docker-compose.dev.yaml up -d</li>
<li><em>Optional</em> Mount <a href="#local-user-accounts">functionalAccounts.json</a> file to a volume in the container to create local users.</li>
<li><em>Optional</em> Mount <a href="#loggers-configuration">loggers.json</a> file to a volume in the container to configure multiple loggers.</li>
<li><em>Optional</em> Mount <a href="#prpopsal-types-configuration">proposalTypes.json</a> file to a volume in the container to configure the proposal types.</li>
<li><em>Optional</em> change the container env variables</li>
<li>Attach to the container</li>
<li><code>npm run start:dev</code></li>
<li>Go to http://localhost:3000/explorer to get an overview of available endpoints and database schemas.</li>
</ol>
<h2 id="test-the-app">Test the app<a class="headerlink" href="#test-the-app" title="Permanent link">¶</a></h2>
<ol>
<li><strong>Running the unit tests:</strong> <code>npm run test</code></li>
<li>
<p><strong>Running the e2e(api) tests:</strong></p>
</li>
<li>
<p>First of all run <code>npm run prepare:local</code> to prepare the local environment for starting</p>
</li>
<li>After that run <code>npm run test:api</code> which will start the backend locally and run both <code>jest</code> and <code>mocha</code> e2e(api) tests.</li>
<li>[Optional] If you want to run only the mocha tests you will need to start the backend locally with <code>npm run start</code> and then use <code>npm run test:api:mocha</code></li>
<li>[Optional] If you want to run only the jest tests you can use <code>npm run test:api:jest</code></li>
</ol>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">¶</a></h2>
<p>There are multiple ways to configure your SciCat instance.</p>
<p>In order to configure a SciCat instance run on barebone OS, there are three options:</p>
<ol>
<li>Edit directly the file <code>src/config/configuration.ts</code></li>
<li>Create a <code>.env</code> file with your local value of the variables listed in the next session. Only the variables that are required by your installation should be defined. To create your <code>.env</code> file, you can copy and edit the sample <code>.env.example</code> provided with in code</li>
<li>Define in your environment all the necessary variables (list provided below), prior running SciCat.</li>
</ol>
<p>If SciCat runs in a containeraized environment, like docker or kubernetes, you can run the release image and specify your configuration using one of the following two methods:</p>
<ol>
<li>create <code>.env</code> and mount it directly in your container.</li>
<li>define the necessary environment variables directly in your container.</li>
</ol>
<p>More information are provided in the official documentation.</p>
<h3 id="local-user-accounts">Local User Accounts<a class="headerlink" href="#local-user-accounts" title="Permanent link">¶</a></h3>
<p>Providing a file called <em>functionalAccounts.json</em> at the root of the project, locally or in the container, will
automatically create the specified accounts on startup. If this file is not provided, no local users will be created.</p>
<p>Follow the structure of <a href="/functionalAccounts.json.minimal.example">functionalAccounts.json.minimal.example</a> to create
your own <em>functionalAccounts.json</em> file.</p>
<h3 id="loggers-configuration">Loggers configuration<a class="headerlink" href="#loggers-configuration" title="Permanent link">¶</a></h3>
<p>Providing a file called <em>loggers.json</em> at the root of the project, locally or in the container, and create an external logger class in the <code>src/loggers/loggingProviders/</code>directory will automatically create specified one or multiple loggers instances.</p>
<p>The <code>loggers.json.example</code> file in the root directory showcases the example of configuration structure for the one or multiple loggers. <code>logger.service.ts</code> file contains the configuration handling process logic, and <code>src/loggers/loggingProviders/grayLogger.ts</code> includes actual usecase of grayLogger.</p>
<h3 id="prpopsal-types-configuration">Prpopsal types configuration<a class="headerlink" href="#prpopsal-types-configuration" title="Permanent link">¶</a></h3>
<p>Providing a file called <em>proposalTypes.json</em> at the root of the project, locally or in the container, will be automatically loaded into the application configuration service under property called <code>proposalTypes</code> and used for validation against proposal creation and update.</p>
<p>The <code>proposalTypes.json.example</code> file in the root directory showcases the example of configuration structure for proposal types.</p>
<h2 id="environment-variables">Environment variables<a class="headerlink" href="#environment-variables" title="Permanent link">¶</a></h2>
<p>Valid environment variables for the .env file. See <a href="/.env.example">.env.example</a> for examples value formats.
| Environment Variable | Type | Optional | Description | Default Value |
|---------------------------------------------|---------|----------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
| <code>ADMIN_GROUPS</code> | string | Yes | Comma-separated list of admin groups with admin permission assigned to the listed users. Example: "admin, ingestor". For more details check: <a href="https://scicatproject.github.io/documentation/Development/v4.x/backend/authorization.html">Scicat Documentation</a> | |
| <code>CREATE_DATASET_GROUPS</code> | string | Yes | Comma-separated list of create dataset groups. Users belong to the listed groups can create dataset with/without PID. Example: "group1, group2". For more details check: <a href="https://scicatproject.github.io/documentation/Development/v4.x/backend/authorization.html">Scicat Documentation</a> | |
| <code>CREATE_DATASET_WITH_PID_GROUPS</code> | string | Yes | Comma-separated list of create dataset with pid groups. Users belong to the listed groups can create dataset with PID. Example: "group1, group2". For more details check: <a href="https://scicatproject.github.io/documentation/Development/v4.x/backend/authorization.html">Scicat Documentation</a> | |
| <code>DELETE_GROUPS</code> | string | Yes | Comma-separated list of delete groups. Users belong to the listed groups can delete any dataset, origDatablocks, datablocks, etc. For more details check: <a href="https://scicatproject.github.io/documentation/Development/v4.x/backend/authorization.html">Scicat Documentation</a> | |
| <code>DATASET_CREATION_VALIDATION_ENABLED</code> | boolean | | Flag to enable/disable dataset validation to validate if requested new dataset is valid with given regular expression. Preconfigure <strong>DATASET_CREATION_VALIDATION_REGEX</strong> variable is required. | false |
| <code>DATASET_CREATION_VALIDATION_REGEX</code> | string | | Regular expression validation for new dataset request. | "" |
| <code>PROPOSAL_GROUPS</code> | string | Yes | Comma-separated list of proposal groups with permission to create any proposals. Example: "proposaladmin, proposalingestor". For more details check: <a href="https://scicatproject.github.io/documentation/Development/v4.x/backend/authorization.html">Scicat Documentation</a> | |
| <code>SAMPLE_GROUPS</code> | string | Yes | Comma-separated list of sample groups with permission to create any samples. Example: "sampleadmin, sampleingestor". For more details check: <a href="https://scicatproject.github.io/documentation/Development/v4.x/backend/authorization.html">Scicat Documentation</a> | |
| <code>ACCESS_GROUPS_GRAPHQL_ENABLED</code> | string | Yes | Flag to enable/disable the GraphQL service to get access groups. Requires configuration of <code>ACCESS_GROUP_SERVICE_TOKEN</code>, <code>ACCESS_GROUP_SERVICE_API_URL</code>, and <code>ACCESS_GROUP_SERVICE_HANDLER</code>. | true |
| <code>ACCESS_GROUPS_SERVICE_TOKEN</code> | string | Yes | Authentication token used if access groups are obtained from a third-party service. Not used by the vanilla installation, but only if the instance is customized to use an external service to provide user groups, like the ESS example. | |
| <code>ACCESS_GROUP_SERVICE_API_URL</code> | string | Yes | URL of the service providing the users' access groups. Not used by the vanilla installation, but only if the instance is customized to use an external service to provide user groups, like the ESS example. | |
| <code>ACCESS_GROUP_SERVICE_HANDLER</code> | string | Yes | Configuration property that points to the source of a module. This module provides a specific responseProcessor function for handling GraphQL responses and a query template for making GraphQL requests. | |
| <code>ACCESS_GROUPS_STATIC_ENABLED</code> | string | Yes | Flag to enable/disable automatic assignment of predefined access groups to all users. | true |
| <code>ACCESS_GROUPS_STATIC_VALUES</code> | string | Yes | Comma-separated list of access groups automatically assigned to all users. Example: "scicat, user". | |
| <code>ACCESS_GROUPS_OIDCPAYLOAD_ENABLED</code> | string | Yes | Flag to enable/disable fetching access groups directly from OIDC response. Requires specifying a field via <code>OIDC_ACCESS_GROUPS_PROPERTY</code> to extract access groups. | false |
| <code>DOI_PREFIX</code> | string | | The facility DOI prefix, with trailing slash. | |
| <code>EXPRESS_SESSION_SECRET</code> | string | No | Secret used to set up express session. Required if using OIDC authentication | |
| <code>HTTP_MAX_REDIRECTS</code> | number | Yes | Max redirects for HTTP requests. | 5 |
| <code>HTTP_TIMEOUT</code> | number | Yes | Timeout for HTTP requests in ms. | 5000 |
| <code>JWT_SECRET</code> | string | | The secret for your JWT token, used for authorization. | |
| <code>JWT_EXPIRES_IN</code> | number | Yes | How long, in seconds, the JWT token is valid. | 3600 |
| <code>LDAP_URL</code> | string | Yes | The URL to your LDAP server. | |
| <code>LDAP_BIND_DN</code> | string | Yes | Bind_DN for your LDAP server. | |
| <code>LDAP_BIND_CREDENTIALS</code> | string | Yes | Credentials for your LDAP server. | |
| <code>LDAP_SEARCH_BASE</code> | string | Yes | Search base for your LDAP server. | |
| <code>LDAP_SEARCH_FILTER</code> | string | Yes | Search filter for your LDAP server. | |
| <code>OIDC_ISSUER</code> | string | Yes | URL of the OIDC server providing the authentication service. Example: https://identity.esss.dk/realm/ess. | |
| <code>OIDC_CLIENT_ID</code> | string | Yes | Identity of the client used to obtain the user token. Example: scicat. | |
| <code>OIDC_CLIENT_SECRET</code> | string | Yes | Secret to provide to the OIDC service to obtain the user token. Example: Aa1JIw3kv3mQlGFWhRrE3gOdkH6xreAwro. | |
| <code>OIDC_CALLBACK_URL</code> | string | Yes | SciCat callback URL to redirect to after a successful login. Example: http://myscicat/api/v3/oidc/callback. | |
| <code>OIDC_SCOPE</code> | string | Yes | Space-separated list of info returned by the OIDC service. Example: "openid profile email". | |
| <code>OIDC_SUCCESS_URL</code> | string | Yes | SciCat Frontend auth-callback URL. Required to pass user credentials to SciCat Frontend after OIDC login. Example: https://myscicatfrontend/auth-callback. Must be <code>frontend-base-url/auth-callback</code> or <code>frontend-base-url/login</code> for the official SciCat frontend. | |
| <code>OIDC_RETURN_URL</code> | string | Yes | The path segment within the SciCat Frontend to redirect to, passed as query param in <code>OIDC_SUCCESS_URL</code> and handled by frontend. Example: /datasets. | |
| <code>OIDC_FRONTEND_CLIENTS</code> | string | Yes | Comma separated list of additional frontend OIDC clients for this backend. Example: scilog,maxiv. Their success and return URLs can be configured by setting <code>OIDC_${CLIENT}_SUCCESS_URL</code> (E.g. <code>OIDC_SCILOG_SUCCESS_URL</code>) and <code>OIDC_${CLIENT}_RETURN_URL</code> | |
| <code>OIDC_ACCESS_GROUPS</code> | string | Yes | Functionality is still unclear. | |
| <code>OIDC_ACCESS_GROUPS_PROPERTY</code> | string | Yes | Target field to get the access groups value from OIDC response. | |
| <code>OIDC_USERINFO_MAPPING_FIELD_USERNAME</code> | string | Yes | Comma-separated list of fields from the OIDC response to use as the user's profile username. Example: <code>OIDC_USERINFO_MAPPING_FIELD_USERNAME="iss, sub"</code>. | "preferred_username" || "name" |
| <code>OIDC_USERINFO_MAPPING_FIELD_DISPLAYNAME</code> | string | Yes | Field from the OIDC response to use as the user's profile display name. Example: <code>OIDC_USERINFO_MAPPING_FIELD_DISPLAYNAME="preferred_username"</code>. | "name" |
| <code>OIDC_USERINFO_MAPPING_FIELD_EMAIL</code> | string | Yes | Field from the OIDC response to use as the user's profile email. | "email" |
| <code>OIDC_USERINFO_MAPPING_FIELD_FAMILYNAME</code> | string | Yes | Field from the OIDC response to use as the user's profile family name. | "family_name" |
| <code>OIDC_USERINFO_MAPPING_FIELD_ID</code> | string | Yes | Field from the OIDC response to use as the user's profile ID. | "sub" || "user_id" |
| <code>OIDC_USERINFO_MAPPING_FIELD_THUMBNAILPHOTO</code>| string | Yes | Field from the OIDC response to use as the user's profile thumbnail photo. | "thumbnailPhoto" |
| <code>OIDC_USERINFO_MAPPING_FIELD_PROVIDER</code> | string | Yes | Field from the OIDC response to use as the user's profile provider. | "iss" |
| <code>OIDC_USERINFO_MAPPING_FIELD_GROUP</code> | string | Yes | Field from the OIDC response to use as the user's profile group. | "groups" |
| <code>OIDC_USERQUERY_OPERATOR</code> | string | Yes | Specifies the operator ("or" or "and") for UserModel.findOne queries, determining the logic used to match fields like "username" or "email". Example: <code>UserModel.findOne({$or: {"username":"testUser", "email":"test@test.com"}})</code>. | "or" |
| <code>OIDC_USERQUERY_FILTER</code> | string | Yes | Defines key-value pairs for UserModel.findOne queries, using a "key:value" format. Example: <code>OIDC_USERQUERY_FILTER="username:sub, email:email"</code>. | "username:username, email:email" |
| <code>LOGBOOK_ENABLED</code> | string | Yes | Flag to enable/disable the Logbook endpoints. Values "yes" or "no". | "no" |
| <code>LOGBOOK_BASE_URL</code> | string | Yes | The base URL to the Logbook API. Only required if Logbook is enabled. | |
| <code>METADATA_KEYS_RETURN_LIMIT</code> | number | Yes | The return limit for the <code>/Datasets/metadataKeys</code> endpoint. | |
| <code>METADATA_PARENT_INSTANCES_RETURN_LIMIT</code> | number | Yes | The return limit of Datasets to extract metadata keys from for the <code>/Datasets/metadataKeys</code> endpoint. | |
| <code>MONGODB_URI</code> | string | | The URI for your MongoDB instance. | |
| <code>OAI_PROVIDER_ROUTE</code> | string | Yes | URI to OAI provider, used for the <code>/publisheddata/:id/resync</code> endpoint. | |
| <code>PID_PREFIX</code> | string | | The facility PID prefix, with trailing slash. | |
| <code>PUBLIC_URL_PREFIX</code> | string | | The base URL to the facility Landing Page. | |
| <code>PORT</code> | number | Yes | The port on which you want to access the app. | 3000 |
| <code>RABBITMQ_ENABLED</code> | string | Yes | Flag to enable/disable RabbitMQ consumer. Values "yes" or "no". | "no" |
| <code>RABBITMQ_HOSTNAME</code> | string | Yes | The hostname of the RabbitMQ message broker. Only required if RabbitMQ is enabled. | |
| <code>RABBITMQ_USERNAME</code> | string | Yes | The username used to authenticate to the RabbitMQ message broker. Only required if RabbitMQ is enabled. | |
| <code>RABBITMQ_PASSWORD</code> | string | Yes | The password used to authenticate to the RabbitMQ message broker. Only required if RabbitMQ is enabled. | |
| <code>REGISTER_DOI_URI</code> | string | | URI to the organization that registers the facility's DOIs. | |
| <code>REGISTER_METADATA_URI</code> | string | | URI to the organization that registers the facility's published data metadata. | |
| <code>SITE</code> | string | | The name of your site. | |
| <code>EMAIL_TYPE</code> | string | Yes | The type of your email provider. Options are "smtp" or "ms365".  | "smtp" |
| <code>EMAIL_FROM</code> | string | Yes | Email address that emails should be sent from. | |
| <code>EMAIL_REPLYTO</code> | string | Yes | Email 'Reply-To' field. | |
| <code>SMTP_HOST</code> | string | Yes | Host of SMTP server. | |
| <code>SMTP_MESSAGE_FROM</code> | string | Yes | (Deprecated) Alternate spelling of EMAIL_FROM.| |
| <code>SMTP_PORT</code> | number | Yes | Port of SMTP server. | 587 |
| <code>SMTP_SECURE</code> | bool | Yes | Use encrypted SMTPS. | "no" |
| <code>MS365_TENANT_ID</code> | string | Yes | Tenant ID for sending emails over Microsoft Graph API. | |
| <code>MS365_CLIENT_ID</code> | string | Yes | Client ID for sending emails over Microsoft Graph API | |
| <code>MS365_CLIENT_SECRET</code> | string | Yes | Client Secret for sending emails over Microsoft Graph API | |
| <code>POLICY_PUBLICATION_SHIFT</code> | integer | Yes | Embargo period expressed in years. | 3 years |
| <code>POLICY_RETENTION_SHIFT</code> | integer | Yes | Retention period (how long the facility will hold on to data) expressed in years. | -1 (indefinitely) |
| <code>ELASTICSEARCH_ENABLED</code> | string | | Flag to enable/disable the Elasticsearch endpoints. Values "yes" or "no". | "no" |
| <code>ES_HOST</code> | string | | Host of Elasticsearch server instance. | |
| <code>ES_USERNAME</code> | string | Yes | Elasticsearch username. | "elastic" |
| <code>ES_PASSWORD</code> | string | | Elasticsearch password. | |
| <code>MONGODB_COLLECTION</code> | string | | Collection name to be mapped into specified Elasticsearch index. Used for data synchronization between MongoDB and Elasticsearch index. | |
| <code>ES_MAX_RESULT</code> | number | | Maximum records that can be indexed into Elasticsearch. | 10000 |
| <code>ES_FIELDS_LIMIT</code> | number | | The total number of fields in an index. | 1000 |
| <code>ES_REFRESH</code> | string | | If set to <code>wait_for</code>, Elasticsearch will wait till data is inserted into the specified index before returning a response. | false |
| <code>LOGGERS_CONFIG_FILE</code> | string | | The file name for loggers configuration, located in the project root directory. | "loggers.json" |
| <code>PROPOSAL_TYPES_FILE</code> | string | | The file name for proposal types configuration, located in the project root directory. | "proposalTypes.json" |
| <code>SWAGGER_PATH</code> | string | Yes | swaggerPath is the path where the swagger UI will be available. | "explorer"|
| <code>MAX_FILE_UPLOAD_SIZE</code> | string | Yes | Maximum allowed file upload size. | "16mb"|</p>
<h2 id="migrating-from-the-old-scicat-backend">Migrating from the old SciCat Backend<a class="headerlink" href="#migrating-from-the-old-scicat-backend" title="Permanent link">¶</a></h2>
<p>Where the <a href="https://github.com/SciCatProject/backend">current SciCat Backend</a> accepts id fields in the database named <code>pid</code>, <code>doi</code>, or similar, this implementation requires there to be an id field of the form <code>_id</code> on every document. It is therefore necessary to run a database migration script towards MongoDB instance from a place where you have access to it and can install <code>migrate-mongo</code> package.</p>
<p>All database <a href="https://github.com/SciCatProject/scicat-backend-next/tree/master/migrations">migration scripts</a> located in the <a href="/migrations/">migrations</a> folder. To start the migration use:</p>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>migrate:db:up
</code></pre></div>
<p>For down migration use:</p>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>migrate:db:down
</code></pre></div>
<p>For listing applied DB migrations:</p>
<div class="highlight"><pre><span></span><code>npm<span class="w"> </span>run<span class="w"> </span>migrate:db:status
</code></pre></div>
<hr>
<p>For the full documentation please go to the <a href="https://scicatproject.github.io/">SciCat home page</a> and follow the <a href="https://scicatproject.github.io/documentation">documentation link</a></p>
<h2 id="migration-documentation-and-nestjs-resources">Migration documentation and NestJs resources<a class="headerlink" href="#migration-documentation-and-nestjs-resources" title="Permanent link">¶</a></h2>
<p>Following are the post that I found useful working on the migration:</p>
<ul>
<li>Schema and DTOs: https://betterprogramming.pub/how-to-use-data-transfer-objects-dto-for-validation-in-nest-js-7ff95309f650</li>
<li>Validation:</li>
<li><a href="https://docs.nestjs.com/techniques/validation">Official documentation</a></li>
<li><a href="https://dev.to/avantar/custom-validation-with-database-in-nestjs-gao">Custom validation with datasbase in NestJs</a></li>
<li><a href="https://dev.to/avantar/validating-nested-objects-with-class-validator-in-nestjs-1gn8">Validating nested objects with class-validator in NestJs</a></li>
<li><a href="https://dev.to/avantar/validating-numeric-query-parameters-in-nestjs-gk9">Validating numeric query parameters in NestJS</a></li>
<li><a href="https://dev.to/avantar/injecting-request-object-to-a-custom-validation-class-in-nestjs-5dal">Injecting request object to a custom validation class in NestJS</a></li>
<li>Swagger and OpenAPI:</li>
<li>https://docs.nestjs.com/openapi/introduction</li>
<li>https://docs.nestjs.com/openapi/types-and-parameters</li>
<li>https://docs.nestjs.com/openapi/decorators</li>
</ul>
<h2 id="license">License<a class="headerlink" href="#license" title="Permanent link">¶</a></h2>
<p>This project is licensed under the GPL License - see the <a href="LICENSE">LICENSE</a> file for details</p>
<h2 id="acknowledgments">Acknowledgments<a class="headerlink" href="#acknowledgments" title="Permanent link">¶</a></h2>
<p>Scicat is developed at PSI, ESS and MAXIV with in-kind funding from ESS and from the European Union Framework Programme for Research and Innovation Horizon 2020, under grant agreement 676548, “BrightnESS”.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["instant"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>